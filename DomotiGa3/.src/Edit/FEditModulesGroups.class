' Gambas class file

' Description:
' FDeviceModules.class
' Support for editing module/devicetypes/groups/locations and floorplans.

' Development Status:
' Finished and working.

' DomotiGa - an open source home automation program.
' Copyright (C) Ron Klinkien, The Netherlands.

' Read file called COPYING for license details.

Public Sub Form_Open()

  Me.Move(FMain.X + 50, FMain.Y + 70)

  With DataBrowserModules.View
    .Columns[0].Text = ("Id")
    .Columns[0].Width = 28
    .Columns[1].Text = ("Name")
    .Columns[1].Width = 170
    .Columns[2].Text = ("Description")
    .Columns[2].Width = 160
    .Columns[3].Text = ("Type")
    .Columns[3].Width = 60
  End With
  With DataBrowserGroups.View
    .Columns[0].Text = ("Id")
    .Columns[0].Width = 28
    .Columns[1].Text = ("Group")
    .Columns[1].Width = 120
  End With
  With DataBrowserLocations.View
    .Columns[0].Text = ("Id")
    .Columns[0].Width = 28
    .Columns[1].Text = ("Location")
    .Columns[1].Width = 120
  End With
  With DataBrowserFloorplans.View
    .Columns[0].Text = ("Id")
    .Columns[0].Width = 28
    .Columns[1].Text = ("Floor")
    .Columns[1].Width = 120
    .Columns[2].Text = ("Image")
    .Columns[2].Width = 70
  End With
  With DataBrowserBlacklist.View
    .Columns[0].Text = ("Id")
    .Columns[0].Width = 28
    .Columns[1].Text = ("Address")
    .Columns[1].Width = 130
    .Columns[2].Text = ("Comments")
    .Columns[2].Width = 130
  End With

End

Public Sub btnClose_Click()

  Me.Close

End

Public Sub btnImageFloor_Click()

  DataControlF2.Value = FSelectImage.Run(Main.sBaseDir &/ "floorplans" &/ DataControlF1.Value, "floorplans")

End

Public Sub btnOnIcon_Click()

  DataControlM5.Value = FSelectImage.Run(Main.sBaseDir &/ "icons" &/ DataControlM5.Value, "icons")
  DisplayIcons()

End

Public Sub btnDimIcon_Click()

  DataControlM6.Value = FSelectImage.Run(Main.sBaseDir &/ "icons" &/ DataControlM6.Value, "icons")
  DisplayIcons()

End

Public Sub btnOffIcon_Click()

  DataControlM7.Value = FSelectImage.Run(Main.sBaseDir &/ "icons" &/ DataControlM7.Value, "icons")
  DisplayIcons()

End

Public Sub DisplayIcons()

  If DataControlM5.Value Then
    Try mbIconOn.Path = Main.sBaseDir &/ "icons" &/ DataControlM5.Value
    If Not Error Then mbIconOn.Playing = True
  Endif
  If DataControlM6.Value Then
    Try mbIconDim.Path = Main.sBaseDir &/ "icons" &/ DataControlM6.Value
    If Not Error Then mbIconDim.Playing = True
  Endif
  If DataControlM7.Value Then
    Try mbIconOff.Path = Main.sBaseDir &/ "icons" &/ DataControlM7.Value
    If Not Error Then mbIconOff.Playing = True
  Endif

End

Public Sub TabStripModules_Click()

  Select TabStripModules.Index
    Case 0
      DataControlM1.Update() ' name
      DataControlM2.Update() ' description
      DataControlM3.Update() ' protocol
      DataControlM4.Update() ' address format
    Case 1
      DataControlM5.Update() ' icon on
      DataControlM6.Update() ' icon off
      DataControlM7.Update() ' icon dim
      DataControlM8.Update() ' label1
      DataControlM9.Update() ' label2
      DataControlM10.Update() ' label3
      DataControlM11.Update() ' label4
    Case 2
      DataComboM1.Update() ' switchable
      DataComboM2.Update() ' dimable
      DataComboM3.Update() ' extended code
  End Select

End
