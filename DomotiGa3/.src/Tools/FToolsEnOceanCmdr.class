' Gambas class file

' Description:
' FToolsEnOceanCmdr.class
' EnOcean Commander for testing and programming.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright (C) Ron Klinkien, The Netherlands.

' Read file called COPYING for license details.

Private hEnOcean As Object

Public Sub Form_Open()

  Me.Move(FMain.X + 50, FMain.Y + 70)
  If Not Main.bServer Then
    Message.Info("This commander doesn't support Client mode yet!")
    Me.Close
  Endif

  Try hEnOcean = Plugin.GetPluginObject("EnOcean", 1).Interface
  If Error Then
    hEnOcean = Null
  Endif

End

Public Sub btnParse_Click()

  Dim aPacket As New Byte[0]
  Dim sFormat As String
  Dim iCnt As Integer

  sFormat = Replace(txtPacket.Text, " ", "")
  sFormat = Replace(sFormat, ",", "")
  If Len(sFormat) Mod 2 Then
    Balloon("Please specify packet in 2 digit bytes!", txtPacket)
  Else
    For iCnt = 1 To Len(sFormat) Step 2
      aPacket.Add(CByte(Val("&H" & Mid(sFormat, iCnt, 2))))
    Next
    If Main.bServer And If hEnOcean Then
      hEnOcean.ProcessReceivedPacket(aPacket)
    Endif
  Endif

End

Public Sub txtPacket_Change()

  If Len(txtPacket.Text) Then
    btnParse.Enabled = True
  Else
    btnParse.Enabled = False
  Endif

End

Public Sub btnClose_Click()

  Me.Close

End
