' Gambas class file

' Description:
' FToolsToon.class
' Toom Commander for testing and programming Toon thermostat.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright (C) Ron Klinkien, The Netherlands.

' Read file called COPYING for license details.

Private hToon As Object
Private iSetpoint As Float = 6.0

Public Sub Form_Open()

  Me.Move(FMain.X + 50, FMain.Y + 70)

  ' disable send button in client mode
  Try hToon = Plugin.GetPluginObject("TOON", 1).Interface
  If Error Then
    hToon = Null
  Endif

End

Public Sub btnClose_Click()

  Me.Close

End

Public Sub btnAway_Click()

  SendSetStateCmd("AWAY")

End

Public Sub btnSleep_Click()

  SendSetStateCmd("SLEEP")

End

Public Sub btnComfort_Click()

  SendSetStateCmd("COMFORT")

End

Public Sub btnHome_Click()

  SendSetStateCmd("HOME")

End

Private Sub SendSetStateCmd(sCmd As String)

  If Main.bServer And If hTOON Then
    hTOON.SetState(sCmd)
  Else
    ' TODO: cleate client code
  Endif

End

Public Sub btnPlus_Click()

  If iSetpoint < 30.0 Then
    iSetpoint += 0.5
    txtSetPoint.Text = Format(iSetpoint, "#.0") & "°"
    SendSetThermostatCmd(iSetpoint)
  Endif

End

Public Sub btnMinus_Click()

  If iSetpoint > 6.0 Then
    iSetpoint -= 0.5
    txtSetPoint.Text = Format(iSetpoint, "#.0") & "°"
    SendSetThermostatCmd(iSetpoint)
  Endif

End

Private Sub SendSetThermostatCmd(iTemp As Integer)

  If Main.bServer And If hTOON Then
    hTOON.SetThermostat(iTemp)
  Else
    ' TODO: cleate client code
  Endif

End