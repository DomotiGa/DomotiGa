' Gambas class file

' Description:
' FMain.class
' Main GUI window

' DomotiGa - an open source home automation program
' Copyright(C) 2008-2009 Ron Klinkien

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. See the
' GNU General PUBLIC License for more details.

' You should have received a copy of the GNU General PUBLIC License
' along with this program. If not, see <http://www.gnu.org/licenses/>.

PUBLIC SUB Form_Open()

  ' open splash/login screen
  FSplashScreen.ShowModal

  ME.Text = Application.Name & " " & Application.Version & " - Open Source Home Automation"
  IF Main.bMainDebug THEN Main.WriteLog("- Main Debug enabled.")
  Main.GlobalVar["Tagline"] = Main.Random_Text("remarks_tags")

  ' temp hack, my method below didn't work for all pages
  ' DIM hForm AS Form
  ' hForm = Object.New(Main.sStartpage)
  ' OpenPage(hForm)
  SELECT CASE Main.sStartpage
    CASE "FHome"
      tbnHome_Click()
    CASE "FControl"
      tbnControl_Click()
    CASE "FFloorplans"
      tbnFloorplans_Click()
    CASE "FLocations"
      tbnLocations_Click()
    CASE "FDevices"
      tbnDevices_Click()
    CASE "FSecurity"
      tbnSecurity_Click()
    CASE "FClimate"
      tbnClimate_Click()
    CASE "FHVAC"
      tbnHVAC_Click()
    CASE "FEnergy"
      tbnEnergy_Click()
    CASE "FEmail"
      tbnEmail_Click()
    CASE "FEvents"
      tbnEvents_Click()
    CASE "FPhone"
      tbnPhone_Click()
    CASE "FCaptures"
      tbnCaptures_Click()
    CASE "FBarcodes"
      tbnBarcodes_Click()
    CASE "FCamera"
      tbnCamera_Click()
    CASE "FNews"
      tbnNews_Click()
    CASE "FTVGuide"
      tbnTVGuide_Click()
    CASE "FWeather"
      tbnWeather_Click()
    CASE "FLogfiles"
      tbnLogFiles_Click()
    CASE "FDebug"
      tbnDebug_Click()
    CASE "FServerStats"
      tbnServerStats_Click()
    CASE ELSE
      tbnHome_Click()
  END SELECT

  Sounds.PlaySnd("click.wav")

END

PUBLIC SUB UpdateStatusPanel()

  ' display correct modes
  txtMode.Text = Main.GlobalVar["House_Mode"]
  txtSunRise.Text = Main.GlobalVar["Sunrise"]
  txtSunSet.Text = Main.GlobalVar["Sunset"]
  ' update e-mail/voice counters
  Main.UpdateCounters()
  ' hide leds of disabled interfaces
  IF Main.bOneWireEnabled THEN
    FMain.tbOneWire.Visible = TRUE
    FMain.pbOneWire.Visible = TRUE
  ELSE
    FMain.tbOneWire.Visible = FALSE
    FMain.pbOneWire.Visible = FALSE
  END IF
  IF Main.bDSCEnabled THEN
    FMain.tbDSC.Visible = TRUE
    FMain.pbDSC.Visible = TRUE
  ELSE
    FMain.tbDSC.Visible = FALSE
    FMain.pbDSC.Visible = FALSE
  END IF
  IF Main.bRFXComRXEnabled OR IF Main.bRFXComTXEnabled THEN
    FMain.tbRFXCom.Visible = TRUE
    FMain.pbRFXCom.Visible = TRUE
  ELSE
    FMain.tbRFXCom.Visible = FALSE
    FMain.pbRFXCom.Visible = FALSE
  END IF
  IF Main.bCTX35Enabled
    FMain.tbX10.Visible = TRUE
    FMain.pbX10.Visible = TRUE
  ELSE
    FMain.tbX10.Visible = FALSE
    FMain.pbX10.Visible = FALSE
  END IF

END

PUBLIC SUB Form_Resize()

  ' sidepanel
  IF spnMain.Hidden THEN
    spnMain.Move(1, 1, 8, ME.ClientHeight - 33)
  ELSE
    spnMain.Move(1, 1, 132, ME.ClientHeight - 33)
  END IF
  ' toolpanel
  tpnMain.Move(1, 1, 123, ME.ClientHeight - 35)
  ' status panel & bar
  pnlStatus.Move(2, ME.ClientHeight - 29, ME.ClientWidth - 4, 24)
  hbStatus.Move(4, 1, ME.ClientWidth - 12, 15)
  ' workspace
  wrkMain.Move(spnMain.Width + 2, 3, ME.ClientWidth - spnMain.Width - 4, ME.ClientHeight - 35)

END

' load a page onto the workspace, or give already loaded page focus.
PUBLIC SUB OpenPage(hForm AS Form)

  wrkMain.Add(hForm)
  wrkMain.ActiveWindow = hForm

END

PUBLIC SUB Form_Close()

  ' exit program
  Main.CloseAll()
  FMain.Close

END

PUBLIC SUB MenuLogout_Click()

  Main.bLogOut = TRUE
  ' show splash screen, load program
  FSplashScreen.ShowModal

END

PUBLIC SUB MenuQuit_Click()

  ' exit program
  Main.CloseAll()
  FMain.Close

END

' about menu entry
PUBLIC SUB MenuAbout_Click()

  FAbout.Show

END

PUBLIC SUB MenuSupport_Click()

  Main.OpenWebPage("http://www.domotiga.nl")

END

PUBLIC SUB MenuDonate_Click()

  Main.OpenWebPage("https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=NT48KZRT7F3FA&lc=US&item_name=DomotiGa%20Open%20Source%20Project&item_number=domotiga&currency_code=EUR&bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHosted")

END

' device menu entries
PUBLIC SUB MenuDeviceModules_Click()

  FEditModulesGroups.Show

END

PUBLIC SUB MenuEditDevices_Click()

  FDeviceEditor.bAddDevice = TRUE
  FDeviceEditor.Show

END

PUBLIC SUB MenuDevicesList_Click()

  OpenPage(FDevices)

END

PUBLIC SUB MenuEditEvents_Click()

  FEventEditor.bAddEvent = TRUE
  FEventEditor.Show

END

PUBLIC SUB MenuEventsList_Click()

  OpenPage(FEvents)

END

PUBLIC SUB MenuEditTriggers_Click()

  FTriggerEditor.bAddTrigger = TRUE
  FTriggerEditor.Show()

END

PUBLIC SUB MenuEditConditions_Click()

  FConditionEditor.bAddCondition = TRUE
  FConditionEditor.Show()

END

PUBLIC SUB MenuEditActions_Click()

  FActionEditor.bAddAction = TRUE
  FActionEditor.Show()

END

' tools menu entries
PUBLIC SUB MenuToolsX10Cmdr_Click()

  FToolsX10Cmdr.Show

END

PUBLIC SUB MenuToolsSerialMonitor_Click()

  FToolsSerialMon.Show

END

PUBLIC SUB MenuToolsSerialPorts_Click()

  FToolsSerialPorts.Show

END

PUBLIC SUB MenuToolsRFXComSimulate_Click()

  FToolsRFXComSimulate.Show

END

PUBLIC SUB MenuToolsDatabaseAdmin_Click()

  FToolsDatabaseAdmin.Show

END

PUBLIC SUB MenuToolsBluetoothBrowser_Click()

  FToolsBluetoothBrowser.Show

END

PUBLIC SUB MenuToolsDSCPanel_Click()

  OpenPage(FDSC)

END

' setup menu entries
PUBLIC SUB MenuSettingsMySQL_Click()

  FSettingsMySQL.Show

END

PUBLIC SUB MenuSettingsMain_Click()

  FSettingsMain.Show

END

PUBLIC SUB MenuSettingsAstro_Click()

  FSettingsAstro.Show

END

PUBLIC SUB MenuSettingsEmail_Click()

  FSettingsEmail.Show

END

PUBLIC SUB MenuSettingsGmail_Click()

  FSettingsGmail.Show

END

PUBLIC SUB MenuSettingsWebServer_Click()

  FSettingsWebServer.Show

END

PUBLIC SUB MenuSettingsTVGuide_Click()

  FSettingsTVGuide.Show

END

PUBLIC SUB MenuSettingsXMLRPC_Click()

  FSettingsXMLRPC.Show

END

PUBLIC SUB MenuSettingsSound_Click()

  FSettingsSound.Show

END

PUBLIC SUB MenuSettingsVoiceText_Click()

  FSettingsVoiceText.Show

END

PUBLIC SUB MenuSettingsAIBO_Click()

  FSettingsAIBO.Show

END

PUBLIC SUB MenuSettingsCTX35_Click()

  FSettingsCTX35.Show

END

PUBLIC SUB MenuSettingsOneWire_Click()

  FSettingsOneWire.Show

END

PUBLIC SUB MenuSettingsSMS_Click()

  FSettingsSMS.Show

END

PUBLIC SUB MenuSettingsDSC_Click()

  FSettingsDSC.Show

END

PUBLIC SUB MenuSettingsGPS_Click()

  FSettingsGPS.Show

END

PUBLIC SUB MenuSettingsHeyu_Click()

  FSettingsHeyu.Show

END

PUBLIC SUB MenuSettingsRFXComRX_Click()

  FSettingsRFXComRX.Show

END

PUBLIC SUB MenuSettingsRFXComTX_Click()

  FSettingsRFXComTX.Show

END
 
PUBLIC SUB MenuSettingsUPS_Click()

  FSettingsUPS.Show

END

PUBLIC SUB MenuSettingsHDDTemp_Click()

  FSettingsHDDTemp.Show

END

PUBLIC SUB MenuSettingsCamVisca_Click()

  FSettingsCamVisca.Show

END

PUBLIC SUB MenuSettingsVideoServer_Click()

  FSettingsVideoServer.Show

END

PUBLIC SUB MenuSettingsBwiredMap_Click()

  FSettingsBwiredMap.Show

END

PUBLIC SUB MenuSettingsRRDTool_Click()

  FSettingsRRDTool.Show

END

PUBLIC SUB MenuSettingsAsterisk_Click()

  FSettingsAsterisk.Show

END

PUBLIC SUB MenuSettingsBluetooth_Click()

  FSettingsBluetooth.Show

END

PUBLIC SUB MenuSettingsWeeder_Click()

  FSettingsWeeder.Show

END

PUBLIC SUB MenuSettingsServerStats_Click()

  FSettingsServerStats.Show

END

PUBLIC SUB MenuSettingsIRMan_Click()

  FSettingsIRMan.Show

END

PUBLIC SUB MenuSettingsPlugwise_Click()

  FSettingsPlugwise.Show

END

PUBLIC SUB MenuSettingsFritzBox_Click()

  FSettingsFritzBox.Show()

END

PUBLIC SUB MenuSettingsTwitter_Click()

  FSettingsTwitter.Show

END

' edit menu entries
PUBLIC SUB MenuEditUsers_Click()

  FEditUsers.Show

END

PUBLIC SUB MenuEditContacts_Click()

  FEditContacts.Show

END

PUBLIC SUB MenuEditNewsfeeds_Click()

  FEditNewsfeeds.Show

END

PUBLIC SUB MenuEditNotify_Click()

  FEditNotify.Show

END

' toolbutton bar entries opening pages on workspace
PUBLIC SUB tbnHome_Click()

  OpenPage(FHome)

END

PUBLIC SUB tbnControl_Click()

  OpenPage(FControl)

END

PUBLIC SUB tbnCaptures_Click()

  OpenPage(FCaptures)

END

PUBLIC SUB tbnClimate_Click()

  OpenPage(FClimate)

END

PUBLIC SUB tbnEvents_Click()

  OpenPage(FEvents)

END

PUBLIC SUB tbnSecurity_Click()

  OpenPage(FSecurity)

END

PUBLIC SUB tbnDevices_Click()

  OpenPage(FDevices)

END

PUBLIC SUB tbnLogFiles_Click()

  OpenPage(FLogfiles)

END

PUBLIC SUB tbnBarcodes_Click()

  OpenPage(FBarcodes)

END

PUBLIC SUB tbnEnergy_Click()

  OpenPage(FEnergy)

END

PUBLIC SUB tbnCamera_Click()

  OpenPage(FCamera)

END

PUBLIC SUB tbnDebug_Click()

  OpenPage(FDebug)

END

PUBLIC SUB tbnServerStats_Click()

  OpenPage(FServerStats)

END

PUBLIC SUB tbnPhone_Click()

  OpenPage(FPhone)

END

PUBLIC SUB tbnNews_Click()

  OpenPage(FNews)

END

PUBLIC SUB tbnHVAC_Click()

  OpenPage(FHVAC)

END

PUBLIC SUB tbnFloorplans_Click()

  OpenPage(FFloorplans)

END

PUBLIC SUB tbnEmail_Click()

  OpenPage(FEmail)

END

PUBLIC SUB tbnLocations_Click()

  OpenPage(FLocations)

END

PUBLIC SUB tbnTVGuide_Click()

  OpenPage(FTVGuide)

END

PUBLIC SUB tbnWeather_Click()

  OpenPage(FWeather)

END

PUBLIC SUB spnMain_Arrange()

  ' resize workspace
  wrkMain.Move(spnMain.Width + 2, 3, ME.ClientWidth - spnMain.Width - 4, ME.ClientHeight - 35)

END
