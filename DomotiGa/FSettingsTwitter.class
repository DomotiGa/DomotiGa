' Gambas class file

' Description:
' FSettingsTwitter.class
' Settings form for Twitter support.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008-2009 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  txtUser.Text = Main.sTwitterUser
  txtPassword.Text = Main.sTwitterPassword
  chkDebug.Value = Main.bTwitterDebug
  chkEnabled.Value = Main.bTwitterEnabled

  IF Main.bTwitterEnabled = FALSE THEN
    txtUser.Enabled = FALSE
    txtPassword.Enabled = FALSE
    chkDebug.Enabled = FALSE
  END IF
  btnSave.Enabled = FALSE

END

PUBLIC SUB ButtonCancel_Click()

  ME.Close

END

PUBLIC SUB txtUser_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtPassword_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkEnabled_Click()

  txtUser.Enabled = chkEnabled.Value
  txtPassword.Enabled = chkEnabled.Value
  chkDebug.Enabled = chkEnabled.Value
  btnSave.Enabled = TRUE

END

PUBLIC SUB btnCancel_Click()

  ME.Close

END

PUBLIC SUB btnDefaults_Click()

  DIM rResult AS Result

  rResult = Main.GetSettingTable("twitter", TRUE) ' get defaults
  IF rResult.Count THEN
    chkEnabled.Value = rResult!enabled
    txtUser.Text = rResult!username
    txtPassword.Text = rResult!password
    chkDebug.Value = rResult!debug
  END IF
  btnSave.Enabled = TRUE

END

PUBLIC SUB btnSave_Click()

  DIM rResult AS Result

  ' save new twitter settings
  rResult = Main.hDB.Exec("UPDATE settings_twitter SET debug = &1, enabled = &2, username = &3, password = &4 WHERE id = 1", chkDebug.Value, chkEnabled.Value, txtUser.Text, txtPassword.Text)
  rResult = Main.GetSettingTable("twitter") ' reload settings
  IF rResult.Count THEN
    Main.bTwitterEnabled = rResult!enabled
    Main.sTwitterUser = rResult!username
    Main.sTwitterPassword = rResult!password
    Main.bTwitterDebug = rResult!debug
  END IF
  Main.Restart_Twitter()

  ME.Close

END

PUBLIC SUB btnTest_Click()

  Twitter.PostTweet("If you can read this, Twitter support is working!")

END

PUBLIC SUB btnWeb_Click()

  Main.OpenWebPage("http://www.twitter.com/domotiga")

END
