' Gambas class file

' Description:
' FSettingsMain.class
' Settings form for program.

' Development Status:
' Works, Flush Timer is not used.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  txtSleepTime.Text = Main.iMainSleepTime
  txtFlushTime.Text = Main.iMainFlushTime
  chkMainDebug.Value = Main.bMainDebug
  chkDevicesDebug.Value = Main.bDevicesDebug
  chkEnergyDebug.Value = Main.bEnergyDebug
  chkEventsDebug.Value = Main.bEventsDebug
  txtLogBuffer.Text = Main.iLogBuffer
  chkAuth.Value = Main.bAuthEnabled
  cmbStartPage.Text = Main.sStartpage
  SELECT CASE Main.sLanguage
    CASE "en_US.UTF-8"
      cmbLanguage.Text = "English"
      pbLanguage.Picture = Picture["icons/en.png"]
    CASE "nl_NL.UTF-8"
      cmbLanguage.Text = "Dutch"
      pbLanguage.Picture = Picture["icons/nl.png"]
    CASE "fr_FR.UTF-8"
      cmbLanguage.Text = "French"
      pbLanguage.Picture = Picture["icons/fr.png"]
  END SELECT
  btnSave.Enabled = FALSE

END

PUBLIC SUB btnSave_Click()

  DIM rResult AS Result

  ' save new settings
  rResult = Main.hDB.Exec("UPDATE settings_main SET authentication = &1, startpage = &2, logbuffer = &3, debug = &4, flushtime = &5, sleeptime = &6, debugevents = &7, debugenergy = &8, debugdevices = &9 WHERE id = 1", chkAuth.Value, cmbStartPage.Text, txtLogBuffer.Text, chkMainDebug.Value, txtFlushTime.Text, txtSleepTime.Text, chkEventsDebug.Value, chkEnergyDebug.Value, chkDevicesDebug.Value)
  SELECT CASE cmbLanguage.Text
    CASE "English"
      Main.sLanguage = "en_US.UTF-8"
      pbLanguage.Picture = Picture["icons/en.png"]
    CASE "Dutch"
      Main.sLanguage = "nl_NL.UTF-8"
      pbLanguage.Picture = Picture["icons/nl.png"]
    CASE "French"
      Main.sLanguage = "fr_FR.UTF-8"
      pbLanguage.Picture = Picture["icons/fr.png"]
  END SELECT

  Main.SetConfig()
  rResult = Main.GetSettingTable("main") ' reload settings

  Main.iMainSleepTime = rResult!sleeptime
  Main.iMainFlushTime = rResult!flushtime
  Main.bMainDebug = rResult!debug
  Main.bEventsDebug = rResult!debugevents
  Main.bEnergyDebug = rResult!debugenergy
  Main.bDevicesDebug = rResult!debugdevices
  Main.iLogBuffer = rResult!logbuffer
  Main.bAuthEnabled = rResult!authentication
  Main.sStartPage = rResult!startpage
  Main.GetConfig()

  ME.Close

END

PUBLIC SUB btnCancel_Click()

  ME.Close

END

PUBLIC SUB chkDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkEventsDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkEnergyDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkDevicesDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB btnDefaults_Click()

  DIM rResult AS Result

  rResult = Main.GetSettingTable("main", TRUE) ' get defaults
  IF rResult.Count THEN
    txtSleepTime.text = rResult!sleeptime
    txtFlushTime.text = rResult!flushtime
    chkMainDebug.Value = rResult!debug
    chkEventsDebug.Value = rResult!debugevents
    chkEnergyDebug.Value = rResult!debugenergy
    chkDevicesDebug.Value = rResult!debugdevices
    txtLogBuffer.text = rResult!logbuffer
    chkAuth.Value = rResult!authentication
    cmbStartPage.Text = rResult!startpage
  END IF
  btnSave.Enabled = TRUE

END

PUBLIC SUB txtSleepTime_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtLogBuffer_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtFlushTime_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkAuth_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB cmbStartPage_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB cmbLanguage_Click()

  btnSave.Enabled = TRUE
  SELECT CASE cmbLanguage.Text
    CASE "English"
      pbLanguage.Picture = Picture["icons/en.png"]
    CASE "Dutch"
      pbLanguage.Picture = Picture["icons/nl.png"]
    CASE "French"
      pbLanguage.Picture = Picture["icons/fr.png"]
  END SELECT

END

PUBLIC SUB chkMainDebug_Click()

  btnSave.Enabled = TRUE

END
