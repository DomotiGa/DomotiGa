' Gambas class file

' Description:
' FSettingsMain.class
' Settings form for program.

' Development Status:
' Works, Flush Timer is not used.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008 Ron Klinkien

' Read file called COPYING for license details.

PRIVATE bLanguageClicked AS Boolean

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  txtSleepTime.Text = Main.iMainSleepTime
  txtFlushTime.Text = Main.iMainFlushTime
  chkMainDebug.Value = Main.bMainDebug
  chkDevicesDebug.Value = Main.bDevicesDebug
  chkEnergyDebug.Value = Main.bEnergyDebug
  chkEventsDebug.Value = Main.bEventsDebug

  btnSave.Enabled = FALSE

END

PUBLIC SUB btnSave_Click()

  DIM rResult AS Result

  ' save new settings
  rResult = Main.hDB.Exec("UPDATE settings_main SET debug = &1, flushtime = &2, sleeptime = &3, debugevents = &4, debugenergy = &5, debugdevices = &6 WHERE id = 1", chkMainDebug.Value, txtFlushTime.Text, txtSleepTime.Text, chkEventsDebug.Value, chkEnergyDebug.Value, chkDevicesDebug.Value)

  Main.SetConfig()
  rResult = Main.GetSettingTable("main") ' reload settings
  Main.iMainSleepTime = rResult!sleeptime
  Main.iMainFlushTime = rResult!flushtime
  Main.bMainDebug = rResult!debug
  Main.bEventsDebug = rResult!debugevents
  Main.bEnergyDebug = rResult!debugenergy
  Main.bDevicesDebug = rResult!debugdevices

  Main.GetConfig()
  IF NOT Main.bStandalone THEN
    XMLClient.ModuleRestart("Main")
  END IF
  IF bLanguageClicked THEN Message.Info(("You need to restart DomotiGa to activate the new language!"))

  ME.Close

END

PUBLIC SUB btnCancel_Click()

  ME.Close

END

PUBLIC SUB chkEventsDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkEnergyDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkDevicesDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB btnDefaults_Click()

  DIM rResult AS Result

  rResult = Main.GetSettingTable("main", TRUE) ' get defaults
  IF rResult.Count THEN
    txtSleepTime.text = rResult!sleeptime
    txtFlushTime.text = rResult!flushtime
    chkMainDebug.Value = rResult!debug
    chkEventsDebug.Value = rResult!debugevents
    chkEnergyDebug.Value = rResult!debugenergy
    chkDevicesDebug.Value = rResult!debugdevices
  END IF
  btnSave.Enabled = TRUE

END

PUBLIC SUB txtSleepTime_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtFlushTime_KeyPress()

  btnSave.Enabled = TRUE

END


PUBLIC SUB chkMainDebug_Click()

  btnSave.Enabled = TRUE

END
