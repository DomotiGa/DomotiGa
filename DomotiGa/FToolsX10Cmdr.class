' Gambas class file

' Description:
' FToolsX10Cmdr.class
' X10 Commander for testing and programming modules.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC rResultInterfaces AS Result
PUBLIC sCommand AS String

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  ' fetch X10 write capable interfaces
  TRY rResultInterfaces = Main.hDB.Exec("SELECT * FROM interfaces")
  IF (rResultInterfaces.Count >= 1) THEN 
    FOR EACH rResultInterfaces
      IF InStr(rResultInterfaces!type, "10") AND InStr(rResultInterfaces!mode, "Write") THEN 
        cmbInterface.Add(rResultInterfaces!name)
      END IF
    NEXT
  ELSE
    Message("No interfaces found!")  
  END IF

END

PUBLIC SUB X10Address() AS String

  RETURN cmbHouseCode.Text & Format(spDeviceCode.Value, "00")

END

PUBLIC SUB btnClose_Click()

  ME.Close

END

PUBLIC SUB btnAllLightsOn_Click()

  SendCmd("ALL_LIGHTS_ON")

END

PUBLIC SUB btnAllLightsOff_Click()

  SendCmd("ALL_LIGHTS_OFF")

END

PUBLIC SUB btnAllUnitsOn_Click()

  SendCmd("ALL_UNITS_OFF")

END

PUBLIC SUB btnAllUnitsOff_Click()

  SendCmd("ALL_UNITS_OFF")

END

PUBLIC SUB btnOn_Click()

  SendCmd("ON")

END

PUBLIC SUB btnOff_Click()

  SendCmd("OFF")

END

PUBLIC SUB btnDim_Click()

  SendCmd("DIM")

END

PUBLIC SUB btnBright_Click()

  SendCmd("BRIGHT")

END

PRIVATE SUB SendCmd(sCmd AS String)

  DIM iCount AS Integer

  FOR iCount = 1 TO spbCount.Value
    Main.hCTX35.sCommandToSend = X10Address() & " " & sCmd
  NEXT

END

