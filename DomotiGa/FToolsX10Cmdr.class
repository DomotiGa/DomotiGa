' Gambas class file

' Description:
' FToolsX10Cmdr.class
' X10 Commander for testing and programming modules.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008-2009 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC rResultInterfaces AS Result
PUBLIC sCommand AS String

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  IF Main.bCTX35Enabled THEN cmbInterface.Add("Xanura CTX35")
  IF Main.bRFXComTXEnabled THEN cmbInterface.Add("RFXCom Transmitter")

END

PUBLIC SUB X10Address() AS String

  RETURN cmbHouseCode.Text & Format(spDeviceCode.Value, "00")

END

PUBLIC SUB btnClose_Click()

  ME.Close

END

PUBLIC SUB btnAllLightsOn_Click()

  SendCmd("ALL_LIGHTS_ON")

END

PUBLIC SUB btnAllLightsOff_Click()

  SendCmd("ALL_LIGHTS_OFF")

END

PUBLIC SUB btnAllUnitsOn_Click()

  SendCmd("ALL_UNITS_OFF")

END

PUBLIC SUB btnAllUnitsOff_Click()

  SendCmd("ALL_UNITS_OFF")

END

PUBLIC SUB btnOn_Click()

  SendCmd("ON")

END

PUBLIC SUB btnOff_Click()

  SendCmd("OFF")

END

PUBLIC SUB btnDim_Click()

  SendCmd("DIM")

END

PUBLIC SUB btnBright_Click()

  SendCmd("BRIGHT")

END

PRIVATE SUB SendCmd(sCmd AS String)

  DIM iCount AS Integer
  DIM bUnit, bDevice AS Byte

  FOR iCount = 1 TO spbCount.Value
    SELECT cmbInterface.Text
    CASE "Xanura CTX35"
      Main.hCTX35.sCommandToSend = X10Address() & " " & sCmd
    CASE "RFXCom Transmitter"
      bUnit = Main.hRFXComTX.GetUnit(Right$(X10Address(), 2), Left$(X10Address(), 1))
      bDevice = Main.hRFXComTX.GetDevice(Right$(X10Address(), 2))
      SELECT sCmd
        CASE "ON"
          Main.hRFXComTX.X10SwitchOn(bUnit, bDevice)
        CASE "OFF"
          Main.hRFXComTX.X10SwitchOff(bUnit, bDevice)
        CASE "DIM"
          Main.hRFXComTX.X10Dim(bUnit, bDevice)
        CASE "BRIGHT"
          Main.hRFXComTX.X10Bright(bUnit, bDevice)
        CASE "ALL_LIGHTS_ON"
          Main.hRFXComTX.X10AllLightsOn(bUnit, bDevice)
        CASE "ALL_LIGHTS_OFF"
          Main.hRFXComTX.X10AllLightsOff(bUnit, bDevice)
      END SELECT
    END SELECT
  NEXT

END

