' Gambas class file

' Description:
' FSettingsTVGuide.class
' Settings form for XML TV Guide support.

' Development Status:
' Just started.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008-2010 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)
  txtXMLGrabCommand.Text = Main.sTVGuideXMLGrabCommand
  txtXMLFile.Text = Main.sTVGuideXMLFile
  chkDebug.Value = Main.bTVGuideDebug
  chkEnabled.Value = Main.bTVGuideEnabled
  btnSave.Enabled = FALSE

  IF Main.bTVGuideEnabled = FALSE THEN 
    txtXMLGrabCommand.Enabled = FALSE
    txtXMLFile.Enabled = FALSE
    btnImportGuide.Enabled = FALSE
    chkDebug.Enabled = FALSE
  END IF

END

PUBLIC SUB chkDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkEnabled_Click()

  txtXMLGrabCommand.Enabled = chkEnabled.Value
  txtXMLFile.Enabled = chkEnabled.Value
  btnImportGuide.Enabled = chkEnabled.Value
  btnSave.Enabled = TRUE

END

PUBLIC SUB btnDefaults_Click()

  DIM rResult AS Result

  rResult = Main.GetSettingTable("tvguide", TRUE) ' get defaults
  IF rResult.Count THEN
    chkEnabled.Value = rResult!enabled
    txtXMLGrabCommand.Text = rResult!xmlgrabcmd
    txtXMLFile.Text = rResult!xmlfile
    chkDebug.Value = rResult!debug
  END IF
  btnSave.Enabled = TRUE

END

PUBLIC SUB btnSave_Click()

  DIM rResult AS Result

  ' save new TVGuide settings
  rResult = Main.hDB.Exec("UPDATE settings_tvguide SET debug = &1, xmlgrabcmd = &2, xmlfile = &3, enabled = &4 WHERE id = 1", chkDebug.Value, txtXMLGrabCommand.Text, txtXMLFile.Text, chkEnabled.Value)
  rResult = Main.GetSettingTable("tvguide") ' reload settings
  IF rResult.Count THEN
    Main.bTVGuideEnabled = rResult!enabled
    Main.sTVGuideXMLGrabCommand = rResult!xmlgrabcmd
    Main.sTVGuideXMLFile = rResult!xmlfile
    Main.bTVGuideDebug = rResult!debug
  END IF
  txtXMLGrabCommand.Text = Main.sTVGuideXMLGrabCommand
  txtXMLFile.Text = Main.sTVGuideXMLFile
  chkDebug.Value = Main.bTVGuideDebug
  chkEnabled.Value = Main.bTVGuideEnabled
  IF Main.bStandalone THEN
    Main.Restart_TVGuide()
  ELSE
    XMLClient.ModuleRestart("TVGuide")
  END IF
  ME.Close

END

PUBLIC SUB btnImportGuide_Click()

  IF Message.Question(("It can take a few minutes before the download and processing is completed, continue ?"), ("Yes"), ("No")) THEN
    TVGuide.ImportGuide()
  END IF

END

PUBLIC SUB btnCancel_Click()

  ME.Close

END

PUBLIC SUB txtXMLGrabCommand_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtXMLFile_KeyPress()

  btnSave.Enabled = TRUE

END
