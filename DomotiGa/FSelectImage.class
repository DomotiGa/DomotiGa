' Gambas class file

' Description:
' FSelectIcon.class
' Provides filechooser for device icons.

' Development Status:
' Working.

' DomotiGa - an open source home automation program.
' Copyright (C) Ron Klinkien, The Netherlands.

' Read file called COPYING for license details.

PRIVATE $sIcon AS String
PRIVATE $sPath AS String

PUBLIC SUB Run(sIcon AS String, sPath AS String) AS String

  $sIcon = sIcon
  $sPath = sPath
  IF NOT ME.ShowModal() THEN RETURN
  RETURN $sIcon

END

PUBLIC SUB Form_Open()

  DIM iPos AS Integer

  INC Application.Busy
  fchIcon.Filter = ["*.png,*.jpg,*.jpeg,*.xpm,*.gif", ("Picture files")]
  fchIcon.Root = Main.sBaseDir &/ $sPath
  fchIcon.ShowBookmark = FALSE
  ' === gambas3 === The following is for gambas 3.3.3+
  TRY fchIcon.ShowPreview = TRUE
  ' === gambas3 === The following hides the directory view 
  TRY fchIcon.DirView.Visible = FALSE

  IF $sIcon THEN
    fchIcon.SelectedPath = $sIcon
  ENDIF

  DEC Application.Busy

END

PUBLIC SUB btnCancel_Click()

  ME.Close

END

PUBLIC SUB btnOK_Click()

  DIM iSpot AS Integer

  ' return only filename part
  $sIcon = fchIcon.SelectedPath
  iSpot = RInStr($sIcon, "/")
  $sIcon = Mid$($sIcon, iSpot + 1, Len($sIcon) - iSpot)

  IF NOT $sIcon THEN RETURN
  ME.Close(TRUE)

END

PUBLIC SUB fchIcon_Activate()

  btnOK.Value = TRUE

END
