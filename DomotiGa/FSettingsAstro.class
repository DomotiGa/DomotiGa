' Gambas class file

' Description:
' FSettingsAstro.class
' Settings form for Astro and Location.

' Development Status:
' Working, Daylight Saving checkbox not used yet.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  txtLatitude.Text = Main.iAstroLatitude
  txtLongitude.Text = Main.iAstroLongitude
  spbTimeZone.Value = Main.iAstroTimezone
  txtSeasons.Text = Main.sAstroSeasons
  txtSeasonStarts.Text = Main.sAstroSeasonStarts
  cmbTwilight.Text = Main.sAstroTwilight
  chkDebug.Value = Main.bAstroDebug
  cmbCurrency.Text = Main.sCurrency
  cmbTemperature.Text = Main.sTemperature
  chkDST.Value = Main.bAstroDST
  btnSave.Enabled = FALSE

END

PUBLIC SUB btnSave_Click()

  DIM rResult AS Result

  ' save new Astro settings
  rResult = Main.hDB.Exec("UPDATE settings_astro SET debug = &1, dst = &2, currency = &3, temperature = &4, latitude = &5, longitude = &6, timezone = &7, seasons = &8, seasonstarts = &9, twilight = &10 WHERE id = 1", chkDebug.Value, chkDST.Value, cmbCurrency.Text, cmbTemperature.Text, txtLatitude.Text, txtLongitude.Text, spbTimeZone.Value, txtSeasons.text, txtSeasonStarts.Text, cmbTwilight.Text)
  rResult = Main.GetSettingTable("astro") ' reload settings
  IF rResult.Count THEN
    Main.iAstroLatitude = rResult!latitude
    Main.iAstroLongitude = rResult!longitude
    Main.iAstroTimeZone = rResult!timezone
    Main.sAstroSeasons = rResult!seasons
    Main.sAstroSeasonStarts = rResult!seasonstarts
    Main.sAstroTwilight = rResult!twilight
    Main.bAstroDebug = rResult!debug
    Main.sCurrency = rResult!currency
    Main.sTemperature = rResult!temperature
    Main.bAstroDST = rResult!dst
  ENDIF
  IF Main.bServer THEN
    Main.Restart_Astro()
  ELSE
    XMLClient.ModuleRestart("Astro")
  ENDIF
  ME.Close

END

PUBLIC SUB btnCancel_Click()

  ME.Close

END

PUBLIC SUB txtLatitude_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtLongitude_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtSeasons_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB txtSeasonStarts_KeyPress()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkDebug_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB btnDefaults_Click()

  DIM rResult AS Result

  rResult = Main.GetSettingTable("astro", TRUE) ' get defaults
  IF rResult.Count THEN
    txtLatitude.Text = rResult!latitude
    txtLongitude.Text = rResult!longitude
    spbTimeZone.Value = rResult!timezone
    txtSeasons.Text = rResult!seasons
    txtSeasonStarts.Text = rResult!seasonstarts
    chkDebug.Value = rResult!debug
    cmbCurrency.Text = rResult!currency
    cmbTemperature.Text = rResult!temperature
    chkDST.Value = rResult!dst
  ENDIF
  btnSave.Enabled = TRUE

END

PUBLIC SUB cmbTwilight_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB spbTimeZone_Change()

  btnSave.Enabled = TRUE

END

PUBLIC SUB cmbCurrency_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB cmbTemperature_Click()

  btnSave.Enabled = TRUE

END

PUBLIC SUB chkDST_Click()

  btnSave.Enabled = TRUE

END
