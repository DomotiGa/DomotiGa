' Gambas class file

' Description:
' FToolsRFXComCmdr.class
' Allows injection of a packet to test RFXCom module parser.
' Provides functions like RFXCom's Manager.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright (C) Ron Klinkien, The Netherlands.

' Read file called COPYING for license details.

' interface commands
CONST msg3undec AS Byte = &H80
CONST msg3RFU6 AS Byte = &H40
CONST msg3RFU5 AS Byte = &H20
CONST msg3RFU4 AS Byte = &H10
CONST msg3RFU3 AS Byte = &H8
CONST msg3FINEOFFSET AS Byte = &H4
CONST msg3RUBICSON AS Byte = &H2
CONST msg3AE AS Byte = &H1

CONST msg4BlindsT1 AS Byte = &H80
CONST msg4BlindsT0 AS Byte = &H40
CONST msg4PROGUARD AS Byte = &H20
CONST msg4FS20 AS Byte = &H10
CONST msg4LCROS AS Byte = &H8
CONST msg4HID AS Byte = &H4
CONST msg4AD AS Byte = &H2
CONST msg4MERTIK AS Byte = &H1

CONST msg5VISONIC AS Byte = &H80
CONST msg5ATI AS Byte = &H40
CONST msg5OREGON AS Byte = &H20
CONST msg5MEI AS Byte = &H10
CONST msg5HEU AS Byte = &H8
CONST msg5AC AS Byte = &H4
CONST msg5ARC AS Byte = &H2
CONST msg5X10 AS Byte = &H1

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

  IF Main.hRFXComRX = NULL THEN
    DisableRX()
  ELSE
    chkDebug.Value = Main.hRFXComRX.RFXComDebug
  ENDIF

  IF Main.hRFXComTX = NULL THEN
    DisableTX()
  ELSE
    chkDebugTX.Value = Main.hRFXComTX.RFXComDebug
  ENDIF

  ' fill combo's with values
  FMain.FillCombo(cmbACDevice1, "4")
  FMain.FillCombo(cmbACDevice2, "FF")
  FMain.FillCombo(cmbACDevice3, "FF")
  FMain.FillCombo(cmbACDevice4, "FF")
  FMain.FillCombo(cmbACUnit, "16")
  FMain.FillCombo(cmbARCDevice, "16")
  FMain.FillCombo(cmbLighting1Unit, "16")

  SetLighting1Commands(cmbLighting1Type.Index)

  FMain.FillCombo(cmbLighting2ID2, "FF")
  FMain.FillCombo(cmbLighting2ID3, "FF")
  FMain.FillCombo(cmbLighting2ID4, "FF")
  FMain.FillCombo(cmbLighting2Unit, "16")

  FMain.FillCombo(cmbLighting5ID1, "FF")
  FMain.FillCombo(cmbLighting5ID2, "FF")
  FMain.FillCombo(cmbLighting5ID3, "FF")
  FMain.FillCombo(cmbLighting5Unit, "16")

  FMain.FillCombo(cmbCurtainUnit, "16")
  FMain.FillCombo(cmbThermostat2Unit, "1F")

  FMain.FillCombo(cmbLighting6ID1, "FF")
  FMain.FillCombo(cmbLighting6ID2, "FF")

END

PRIVATE SUB SetLighting1Commands(iMode AS Integer)

  SELECT iMode
    CASE 0, 5 ' X10, EWM200
      btnLighting1AllOn.Enabled = TRUE
      btnLighting1AllOff.Enabled = TRUE
      btnLighting1Chime.Enabled = FALSE
    CASE 1 ' ARC
      btnLighting1AllOn.Enabled = TRUE
      btnLighting1AllOff.Enabled = TRUE
      btnLighting1Chime.Enabled = TRUE
    CASE 3, 4, 6 ' ELRO AB400, Waveman, Impuls
      btnLighting1AllOn.Enabled = FALSE
      btnLighting1AllOff.Enabled = FALSE
      btnLighting1Chime.Enabled = FALSE
  END SELECT

END

PUBLIC SUB btnClose_Click()

  ME.Close

END

PUBLIC SUB btnInject_Click()

  Main.hRFXComRX.bSimulate = TRUE
  IF txtPacketRX.Text THEN Main.hRFXComRX.Simulate(txtPacketRX.Text)

END

PUBLIC SUB btnVersion_Click()

  Main.hRFXComRX.GetVersion()

END

PUBLIC SUB btnEnableAll_Click()

  Main.hRFXComRX.ProtocolSetup("ALL")

END

PUBLIC SUB btnOregon_Click()

  Main.hRFXComRX.ProtocolSetup("OREGON")

END

PUBLIC SUB btnX10_Click()

  Main.hRFXComRX.ProtocolSetup("X10")

END

PUBLIC SUB btnARC_Click()

  Main.hRFXComRX.ProtocolSetup("ARC")

END

PUBLIC SUB btnKoppla_Click()

  Main.hRFXComRX.ProtocolSetup("KOPPLA")

END

PUBLIC SUB btnATI_Click()

  Main.hRFXComRX.ProtocolSetup("ATI")

END

PUBLIC SUB btnVisonic_Click()

  Main.hRFXComRX.ProtocolSetup("VISONIC")

END

PUBLIC SUB btnSomfy_Click()

  Main.hRFXComRX.ProtocolSetup("SOMFY")

END

PUBLIC SUB btnHEUK_Click()

  Main.hRFXComRX.ProtocolSetup("HEUK")

END

PUBLIC SUB btnHEEU_Click()

  Main.hRFXComRX.ProtocolSetup("HEEU")

END

PUBLIC SUB chkDebug_Click()

  Main.hRFXComRX.RFXComDebug = chkDebug.Value

END

PUBLIC SUB DisableRX()

  btnSomfy.Enabled = FALSE
  btnVisonic.Enabled = FALSE
  btnATI.Enabled = FALSE
  btnKoppla.Enabled = FALSE
  btnARC.Enabled = FALSE
  btnX10.Enabled = FALSE
  btnOregon.Enabled = FALSE
  btnHEUK.Enabled = FALSE
  btnHEEU.Enabled = FALSE
  btnVersion.Enabled = FALSE
  btnEnableAll.Enabled = FALSE
  btnInject.Enabled = FALSE
  chkDebug.Enabled = FALSE

END

PUBLIC SUB DisableTX()

  btnVersionTX.Enabled = FALSE
  btnEnableARCTX.Enabled = FALSE
  btnEnableHarrisonTX.Enabled = FALSE
  btnDisableX10TX.Enabled = FALSE
  chkDebugTX.Enabled = FALSE
  btnEnableKopplaTX.Enabled = FALSE
  slDim.Enabled = FALSE

  ' ARC / X10
  btnARCOn.Enabled = FALSE
  btnARCOff.Enabled = FALSE
  btnARCDim.Enabled = FALSE
  btnARCBright.Enabled = FALSE
  btnARCLightsOff.Enabled = FALSE
  btnARCLightsOn.Enabled = FALSE
  cmbARCHouse.Enabled = FALSE
  cmbARCDevice.Enabled = FALSE

  ' AC / HE UK
  cmbACDevice1.Enabled = FALSE
  cmbACDevice2.Enabled = FALSE
  cmbACDevice3.Enabled = FALSE
  cmbACDevice4.Enabled = FALSE
  cmbACUnit.Enabled = FALSE
  btnACOff.Enabled = FALSE
  btnACOn.Enabled = FALSE
  chkHEEU.Enabled = FALSE
  tbtnACGroup.Enabled = FALSE

END

' transmitter code below this line
PUBLIC SUB chkDebugTX_Click()

  Main.hRFXComTX.RFXComDebug = chkDebug.Value

END

PUBLIC SUB btnVersionTX_Click()

  Main.hRFXComTX.GetVersion()

END

PUBLIC SUB btnEnableARCTX_Click()

  Main.hRFXComTX.EnableARCTX()

END

PUBLIC SUB btnEnableHarrisonTX_Click()

  Main.hRFXComTX.EnableHarrisonTX()

END

PUBLIC SUB btnEnableKopplaTX_Click()

  Main.hRFXComTX.EnableKopplaTX()

END

PUBLIC SUB btnDisableX10TX_Click()

  Main.hRFXComTX.DisableX10TX()

END

PUBLIC SUB ControlTX(sAddress AS String, sCmd AS String)

  Main.hRFXComTX.X10(sAddress, sCmd)

END

' ARC
PUBLIC SUB btnARCOn_Click()

  ControlTX(cmbARCHouse.Text & Format(cmbARCDevice.Text, "00"), "On")

END

PUBLIC SUB btnARCOff_Click()

  ControlTX(cmbARCHouse.Text & Format(cmbARCDevice.Text, "00"), "Off")

END

PUBLIC SUB btnARCDim_Click()

  ControlTX(cmbARCHouse.Text & Format(cmbARCDevice.Text, "00"), "Dim")

END

PUBLIC SUB btnARCBright_Click()

  ControlTX(cmbARCHouse.Text & Format(cmbARCDevice.Text, "00"), "Bright")

END

PUBLIC SUB btnARCLightsOn_Click()

  ControlTX(cmbARCHouse.Text & Format(cmbARCDevice.Text, "00"), "All_Lights_On")

END

PUBLIC SUB btnARCLightsOff_Click()

  ControlTX(cmbARCHouse.Text & Format(cmbARCDevice.Text, "00"), "All_Lights_Off")

END

' AC / HEEU
PUBLIC SUB btnACOn_Click()

  Main.hRFXComTX.AC(cmbACDevice1.Index & cmbACDevice2.Text & cmbACDevice3.Text & cmbACDevice4.Text & " " & cmbACUnit.Text, "On", chkHEEU.Value, tbtnACGroup.Value)

END

PUBLIC SUB btnACOff_Click()

  Main.hRFXComTX.AC(cmbACDevice1.Index & cmbACDevice2.Text & cmbACDevice3.Text & cmbACDevice4.Text & " " & cmbACUnit.Text, "Off", chkHEEU.Value, tbtnACGroup.Value)

END

PUBLIC SUB slDim_Change()

  Main.hRFXComTX.AC(cmbACDevice1.Index & cmbACDevice2.Text & cmbACDevice3.Text & cmbACDevice4.Text & " " & cmbACUnit.Text, "Dim " & slDim.Value, chkHEEU.Value, tbtnACGroup.Value)

END

PUBLIC SUB cmbLighting1Type_Click()

  SetLighting1Commands(cmbLighting1Type.Index)

END

' TRX lighting1
PUBLIC SUB btnLighting1On_Click()

  Main.hRFXComTRX.Lighting1(cmbLighting1Type.Text, cmbLighting1House.Text & Format(cmbLighting1Unit.Text, "00"), "ON", chkLighting1Group.Value)

END

PUBLIC SUB btnLighting1Off_Click()

  Main.hRFXComTRX.Lighting1(cmbLighting1Type.Text, cmbLighting1House.Text & Format(cmbLighting1Unit.Text, "00"), "OFF", chkLighting1Group.Value)

END

PUBLIC SUB btnLighting1Chime_Click()

  Main.hRFXComTRX.Lighting1(cmbLighting1Type.Text, cmbLighting1House.Text & Format(cmbLighting1Unit.Text, "00"), "CHIME", chkLighting1Group.Value)

END

PUBLIC SUB btnLighting1AllOn_Click()

  Main.hRFXComTRX.Lighting1(cmbLighting1Type.Text, cmbLighting1House.Text & Format(cmbLighting1Unit.Text, "00"), "ALL ON", chkLighting1Group.Value)

END

PUBLIC SUB btnLighting1AllOff_Click()

  Main.hRFXComTRX.Lighting1(cmbLighting1Type.Text, cmbLighting1House.Text & Format(cmbLighting1Unit.Text, "00"), "ALL OFF", chkLighting1Group.Value)

END

PUBLIC SUB btnLighting2On_Click()

  Main.hRFXComTRX.Lighting2(cmbLighting2Type.Text, cmbLighting2ID1.Text & cmbLighting2ID2.Text & cmbLighting2ID3.Text & cmbLighting2ID4.Text & " " & cmbLighting2Unit.Text, "ON", chkLighting2Group.Value)

END

PUBLIC SUB btnLighting2Off_Click()

  Main.hRFXComTRX.Lighting2(cmbLighting2Type.Text, cmbLighting2ID1.Text & cmbLighting2ID2.Text & cmbLighting2ID3.Text & cmbLighting2ID4.Text & " " & cmbLighting2Unit.Text, "OFF", chkLighting2Group.Value)

END

PUBLIC SUB btnLighting2AllOn_Click()

  Main.hRFXComTRX.Lighting2(cmbLighting2Type.Text, cmbLighting2ID1.Text & cmbLighting2ID2.Text & cmbLighting2ID3.Text & cmbLighting2ID4.Text & " " & cmbLighting2Unit.Text, "ALL ON", chkLighting2Group.Value)

END

PUBLIC SUB btnLighting2AllOff_Click()

  Main.hRFXComTRX.Lighting2(cmbLighting2Type.Text, cmbLighting2ID1.Text & cmbLighting2ID2.Text & cmbLighting2ID3.Text & cmbLighting2ID4.Text & " " & cmbLighting2Unit.Text, "ALL OFF", chkLighting2Group.Value)

END

PUBLIC SUB slLighting2Dim_Change()

  Main.hRFXComTRX.Lighting2(cmbLighting2Type.Text, cmbLighting2ID1.Text & cmbLighting2ID2.Text & cmbLighting2ID3.Text & cmbLighting2ID4.Text & " " & cmbLighting2Unit.Text, "DIM " & slLighting2Dim.Value, chkLighting2Group.Value)

END

PUBLIC SUB btnTRXSave_Click()

  Main.hRFXComTRX.ProtocolSetup("SAVE")

END

PUBLIC SUB btnTRXReset_Click()

  Main.hRFXComTRX.ProtocolSetup("RESET")

END

PUBLIC SUB btnTRXGetStatus_Click()

  Main.hRFXComTRX.ProtocolSetup("STATUS")

END

PUBLIC SUB btnTRXSetMode_Click()

  DIM aMsg AS Byte[4]

  aMsg[0] = &H53

  IF chkTRXUndec.Value THEN
    aMsg[1] = &H80
  ELSE
    aMsg[1] = 0
  ENDIF

  IF chkTRXBlinds0.Value THEN
    ' All other protocol receiving is disabled if BlindsT0 enabled
    ' BlindsT0 receive is only used to read the address code of the remote
    aMsg[2] = aMsg[2] OR msg4BlindsT0
    aMsg[3] = 0
  ELSE
    ' msg3
    IF chkTRXRFU6.Value THEN
      aMsg[1] = aMsg[1] OR msg3RFU6
    ENDIF
    IF chkTRXRFU5.Value THEN
      aMsg[1] = aMsg[1] OR msg3RFU5
    ENDIF
    IF chkTRXRFU4.Value THEN
      aMsg[1] = aMsg[1] OR msg3RFU4
    ENDIF
    IF chkTRXRFU3.Value THEN
      aMsg[1] = aMsg[1] OR msg3RFU3
    ENDIF
    IF chkTRXFineOffset.Value THEN
      aMsg[1] = aMsg[1] OR msg3FINEOFFSET
    ENDIF
    IF chkTRXRubicson.Value THEN
      aMsg[1] = aMsg[1] OR msg3RUBICSON
    ENDIF
    IF chkTRXAE.Value THEN
      aMsg[1] = aMsg[1] OR msg3AE
    ENDIF

    ' msg4
    IF chkTRXBlinds1.Value THEN
      aMsg[2] = aMsg[2] OR msg4BlindsT1
    ENDIF
    IF chkTRXProGuard.Value THEN
      aMsg[2] = aMsg[2] OR msg4PROGUARD
    ENDIF
    IF chkTRXFS20.Value THEN
      aMsg[2] = aMsg[2] OR msg4FS20
    ENDIF
    IF chkTRXLaCrosse.Value THEN
      aMsg[2] = aMsg[2] OR msg4LCROS
    ENDIF
    IF chkTRXHideki.Value THEN
      aMsg[2] = aMsg[2] OR msg4HID
    ENDIF
    IF chkTRXAD.Value THEN
      aMsg[2] = aMsg[2] OR msg4AD
    ENDIF
    IF chkTRXMertik.Value THEN
      aMsg[2] = aMsg[2] OR msg4MERTIK
    ENDIF

    ' msg5
    IF chkTRXVisonic.Value THEN
      aMsg[3] = aMsg[3] OR msg5VISONIC
    ENDIF
    IF chkTRXATI.Value THEN
      aMsg[3] = aMsg[3] OR msg5ATI
    ENDIF
    IF chkTRXOregon.Value THEN
      aMsg[3] = aMsg[3] OR msg5Oregon
    ENDIF
    IF chkTRXMeiantech.Value THEN
      aMsg[3] = aMsg[3] OR msg5MEI
    ENDIF
    IF chkTRXHEEU.Value THEN
      aMsg[3] = aMsg[3] OR msg5HEU
    ENDIF
    IF chkTRXAC.Value THEN
      aMsg[3] = aMsg[3] OR msg5AC
    ENDIF
    IF chkTRXARC.Value THEN
      aMsg[3] = aMsg[3] OR msg5ARC
    ENDIF
    IF chkTRXX10.Value THEN
      aMsg[3] = aMsg[3] OR msg5X10
    ENDIF
  ENDIF
  Main.hRFXComTRX.ProtocolSetup("SETMODE", aMsg)

END

PUBLIC SUB btnInjectTRX_Click()

  Main.hRFXComTRX.Simulate(txtPacketTRX.Text)

END

PUBLIC SUB btnLighting5On_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "ON")

END

PUBLIC SUB btnLighting5Off_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "OFF")

END

PUBLIC SUB btnLighting5GrpOff_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "GROUP OFF")

END

PUBLIC SUB btnLighting5GrpOn_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "GROUP ON")

END

PUBLIC SUB btnLighting5Mood1_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "MOOD1")

END

PUBLIC SUB btnLighting5Mood2_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "MOOD2")

END

PUBLIC SUB btnLighting5Mood3_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "MOOD3")

END

PUBLIC SUB btnLighting5Mood4_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "MOOD4")

END

PUBLIC SUB btnLighting5Mood5_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "MOOD5")

END

PUBLIC SUB btnLighting5Close_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "CLOSe")

END

PUBLIC SUB btnLighting5Stop_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "STOP")

END

PUBLIC SUB btnLighting5Open_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "OPEN")

END

PUBLIC SUB btnLighting5Unlock_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "UNLOCK")

END

PUBLIC SUB btnLighting5Lock_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "LOCK")

END

PUBLIC SUB btnLighting5AllLock_Click()

  Main.hRFXComTRX.Lighting5(cmbLighting5Type.Text, cmbLighting5ID1.Text & cmbLighting5ID2.Text & cmbLighting5ID3.Text & " " & cmbLighting5Unit.Text, "ALL LOCK")

END

PUBLIC SUB btnLighting6On_Click()

  Main.hRFXComTRX.Lighting6(cmbLighting6Type.Text, cmbLighting6ID1.Text & cmbLighting6ID2.Text & " " & cmbLighting6Group.Text & cmbLighting6Unit.Text, "ON")

END

PUBLIC SUB btnLighting6Off_Click()

  Main.hRFXComTRX.Lighting6(cmbLighting6Type.Text, cmbLighting6ID1.Text & cmbLighting6ID2.Text & " " & cmbLighting6Group.Text & cmbLighting6Unit.Text, "OFF")

END

PUBLIC SUB btnLighting6GroupOff_Click()

  Main.hRFXComTRX.Lighting6(cmbLighting6Type.Text, cmbLighting6ID1.Text & cmbLighting6ID2.Text & " " & cmbLighting6Group.Text & cmbLighting6Unit.Text, "GROUP OFF")

END

PUBLIC SUB btnLighting6GroupOn_Click()

  Main.hRFXComTRX.Lighting6(cmbLighting6Type.Text, cmbLighting6ID1.Text & cmbLighting6ID2.Text & " " & cmbLighting6Group.Text & cmbLighting6Unit.Text, "GROUP ON")

END

PUBLIC SUB btnCurtainOpen_Click()

  Main.hRFXComTRX.Curtain(cmbCurtainType.Text, cmbCurtainHouse.Text & Format(cmbCurtainUnit.Text, "00"), "OPEN")

END

PUBLIC SUB btnCurtainClose_Click()

  Main.hRFXComTRX.Curtain(cmbCurtainType.Text, cmbCurtainHouse.Text & Format(cmbCurtainUnit.Text, "00"), "CLOSE")

END

PUBLIC SUB btnCurtainStop_Click()

  Main.hRFXComTRX.Curtain(cmbCurtainType.Text, cmbCurtainHouse.Text & Format(cmbCurtainUnit.Text, "00"), "STOP")

END

PUBLIC SUB btnCurtainProgram_Click()

  Main.hRFXComTRX.Curtain(cmbCurtainType.Text, cmbCurtainHouse.Text & Format(cmbCurtainUnit.Text, "00"), "PROGRAM")

END

PUBLIC SUB btnThermostat2On_Click()

  Main.hRFXComTRX.Thermostat2(cmbThermostat2Type.Text, cmbThermostat2Unit.Text, "ON")

END

PUBLIC SUB btnThermostat2Off_Click()

  Main.hRFXComTRX.Thermostat2(cmbThermostat2Type.Text, cmbThermostat2Unit.Text, "OFF")

END

PUBLIC SUB btnThermostat2Program_Click()

  Main.hRFXComTRX.Thermostat2(cmbThermostat2Type.Text, cmbThermostat2Unit.Text, "PROGRAM")

END