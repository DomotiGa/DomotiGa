' Gambas class file

' Description:
' FToolsPLCBUSCmdr.class
' PLCBUS Commander for testing and programming modules.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008-2010 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC rResultInterfaces AS Result
PUBLIC sCommand AS String

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

END

PUBLIC SUB PLCBUSAddress() AS String

  RETURN cmbHouseCode.Text & Format(spDeviceCode.Value, "00")

END

PUBLIC SUB btnClose_Click()

  ME.Close

END

PUBLIC SUB btnAllLightsOn_Click()

  SendCmd("ALL_LIGHTS_ON", chkAck.Value)

END

PUBLIC SUB btnAllLightsOff_Click()

  SendCmd("ALL_LIGHTS_OFF", chkAck.Value)

END

PUBLIC SUB btnAllUnitsOn_Click()

  SendCmd("ALL_UNITS_ON", chkAck.Value)

END

PUBLIC SUB btnAllUnitsOff_Click()

  SendCmd("ALL_UNITS_OFF", chkAck.Value)

END

PUBLIC SUB btnOn_Click()

  SendCmd("ON", chkAck.Value)

END

PUBLIC SUB btnOff_Click()

  SendCmd("OFF", chkAck.Value)

END

PUBLIC SUB btnDim_Click()

  SendCmd("DIM " & spRate.Value, chkAck.Value)

END

PUBLIC SUB btnBright_Click()

  SendCmd("BRIGHT " & spRate.Value, chkAck.Value)

END

PRIVATE SUB SendCmd(sCmd AS String, bAck AS Boolean)

  IF Main.hPLCBUS THEN Main.hPLCBUS.PLCBUSTXCommand(PLCBUSAddress(), sCmd, bAck)

END

PUBLIC SUB btnGetID_Click()

  SendCmd("GET_ONLY_ON_ID_PULSE", FALSE)

END

PUBLIC SUB slDim_MouseUp()

  SendCmd("PRESETDIM " & slDim.Value & " " & spRate.Value, chkAck.Value)

END

PUBLIC SUB btnGetSignal_Click()

  SendCmd("GET_SIGNAL_STRENGTH", chkAck.Value)

END

PUBLIC SUB btnGetNoise_Click()

  SendCmd("GET_NOISE_STRENGTH", chkAck.Value)

END
