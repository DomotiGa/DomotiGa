' Gambas class file

' Description:
' FToolsPLCBUSCmdr.class
' PLCBUS Commander for testing and programming modules.

' Development Status:
' Works.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008-2011 Ron Klinkien

' Read file called COPYING for license details.

PUBLIC rResultInterfaces AS Result
PUBLIC sCommand AS String

PUBLIC SUB Form_Open()

  ME.Move(FMain.X + 50, FMain.Y + 70)

END

PUBLIC SUB PLCBUSAddress() AS String

  RETURN cmbHouseCode.Text & Format(spDeviceCode.Value, "00")

END

PUBLIC SUB btnClose_Click()

  ME.Close

END

PUBLIC SUB btnAllLightsOn_Click()

  SendCmd("ALL_LIGHTS_ON", chkAck.Value)

END

PUBLIC SUB btnAllLightsOff_Click()

  SendCmd("ALL_LIGHTS_OFF", chkAck.Value)

END

PUBLIC SUB btnAllUnitsOn_Click()

  SendCmd("ALL_UNITS_ON", chkAck.Value)

END

PUBLIC SUB btnAllUnitsOff_Click()

  SendCmd("ALL_UNITS_OFF", chkAck.Value)

END

PUBLIC SUB btnOn_Click()

  SendCmd("ON", chkAck.Value)

END

PUBLIC SUB btnOff_Click()

  SendCmd("OFF", chkAck.Value)

END

PUBLIC SUB btnDim_Click()

  SendCmd("DIM " & spRate.Value, chkAck.Value)

END

PUBLIC SUB btnBright_Click()

  SendCmd("BRIGHT " & spRate.Value, chkAck.Value)

END

PRIVATE SUB SendCmd(sCmd AS String, bAck AS Boolean)

  IF Main.hPLCBUS THEN Main.hPLCBUS.PLCBUSTXCommand(PLCBUSAddress(), sCmd, bAck)

END

PUBLIC SUB btnGetID_Click()

  SendCmd("GET_ONLY_ON_ID_PULSE", FALSE)

END

PUBLIC SUB slDim_MouseUp()

  SendCmd("PRESETDIM " & slDim.Value & " " & spRate.Value, chkAck.Value)

END

PUBLIC SUB btnGetSignal_Click()

  SendCmd("GET_SIGNAL_STRENGTH", chkAck.Value)

END

PUBLIC SUB btnGetNoise_Click()

  SendCmd("GET_NOISE_STRENGTH", chkAck.Value)

END

PUBLIC SUB btnSceneSetup_Click()

  SendSceneCmd("SCENE_ADDR_SETUP", PLCBUSSceneCmd())

END

PUBLIC SUB btnEraseScene_Click()

  SELECT Message.Question("Are you sure that you want to delete scene " & PLCBUSSceneAddress() & "?", (" Yes "), (" No "))
    CASE 1
      SendSceneCmd("SCENE_ADDR_ERASE")
  END SELECT

END

PUBLIC SUB btnEraseSceneAll_Click()

  SELECT Message.Question("Are you sure that you want to delete all scenes?", ("Yes"), ("No"))
    CASE 1
      SendSceneCmd("ALL_SCENE_ADDR_ERASE")
  END SELECT

END

PUBLIC SUB PLCBUSSceneCmd() AS Byte

  SELECT cmbSceneCmd.Index
    CASE 0
      RETURN &H02
    CASE 1
      RETURN &H03
  END SELECT

END

PUBLIC SUB PLCBUSSceneAddress() AS String

  RETURN cmbSceneCode.Text & Format(spSceneDevice.Value, "00")

END

PRIVATE SUB SendSceneCmd(sCmd AS String, OPTIONAL bData AS Byte)

  IF Main.hPLCBUS THEN Main.hPLCBUS.PLCBUSTXCommand(PLCBUSSceneAddress(), sCmd, FALSE, bData)

END