' Gambas class file

' Description:
' FSystemStats.class
' Display all server related rrdtool graphs.

' Development Status:
' Working.

' DomotiGa - an open source home automation program.
' Copyright(C) 2008 Ron Klinkien

' Read file called LICENSE for license details.

PRIVATE tRefresh AS NEW Timer
PRIVATE bAutoRefresh AS Boolean
PRIVATE iMode AS Integer = 0

PUBLIC SUB Form_Open()

  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

  ' create refresh timer
  tRefresh = NEW Timer AS "tRefresh"
  tRefresh.Delay = 30000 ' 30 seconds
  btnOverview.Enabled = FALSE

END

PUBLIC SUB Form_Resize()

  svGraphs.Move(4, 30, ME.ClientWidth - 8, ME.ClientHeight - 31)

END

PUBLIC SUB Form_Close()

  tRefresh.Stop

END

'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
' refresh contents
'~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
PUBLIC SUB tRefresh_Timer()

  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  IF NOT iMode THEN Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB btnOverview_Click()

  iMode = 0
  btnOverview.Enabled = FALSE
  btnGraphsDay.Enabled = TRUE
  btnGraphsWeek.Enabled = TRUE
  btnGraphsMonth.Enabled = TRUE
  btnGraphsYear.Enabled = TRUE
  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB btnGraphsDay_Click()

  iMode = 1
  btnOverview.Enabled = TRUE
  btnGraphsDay.Enabled = FALSE
  btnGraphsWeek.Enabled = TRUE
  btnGraphsMonth.Enabled = TRUE
  btnGraphsYear.Enabled = TRUE
  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB btnGraphsWeek_Click()

  iMode = 2
  btnOverview.Enabled = TRUE
  btnGraphsDay.Enabled = TRUE
  btnGraphsWeek.Enabled = FALSE
  btnGraphsMonth.Enabled = TRUE
  btnGraphsYear.Enabled = TRUE
  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB btnGraphsMonth_Click()

  iMode = 3
  btnOverview.Enabled = TRUE
  btnGraphsDay.Enabled = TRUE
  btnGraphsWeek.Enabled = TRUE
  btnGraphsMonth.Enabled = FALSE
  btnGraphsYear.Enabled = TRUE
  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB btnGraphsYear_Click()

  iMode = 4
  btnOverview.Enabled = TRUE
  btnGraphsDay.Enabled = TRUE
  btnGraphsWeek.Enabled = TRUE
  btnGraphsMonth.Enabled = TRUE
  btnGraphsYear.Enabled = FALSE
  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB btnRefresh_Click()

  ServerStats.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs)
  IF NOT iMode THEN Main.DisplayGraphs(iMode, "Server", FServerStats.vpnlGraphs, TRUE)

END

PUBLIC SUB tbtnRefresh_Click()

  IF tbtnRefresh.Value = TRUE THEN
    tRefresh.Start
    bAutoRefresh = TRUE
    btnRefresh.Enabled = FALSE
  ELSE
    tRefresh.Stop
    bAutoRefresh = FALSE
    btnRefresh.Enabled = TRUE
  END IF

END
